<rnd-breadcrumb>
  <!-- search box -->
  <rnd-searchbox options="{placeholder:'buscar entidad', nameprop:'NOKOEN'}"
                 meta="metaEntidad.data"
                 dataset="pasoEntidad"
                 source="traeEntidad"
                 dialog="{onChange:onChangeEntidad}"
                 rtablas="metaEntidad.rtablas">
  </rnd-searchbox>
  <!-- /search box -->
</rnd-breadcrumb>

<section ng-if="pasoEntidad.data.length">

  <!-- #ROW: Entidad, Deuda -->
  <div rnd-row
       class="rnd-gray">

    <div class="col-xs-4">
      <!-- Entidad -->
      <rnd-profile meta="metaEntidad.data"
                   options="{showEmpty:'<h2>¡Nadie aquí!</h2><p>Usa el cuadro de búsqueda para traer la deuda de un cliente</p>', title:'Datos entidad'}"
                   source="pasoEntidad"
                   rtablas="metaEntidad.rtablas">
      </rnd-profile>
      <!-- /Entidad -->
    </div>

    <div class="col-xs-8 pt-20">
      <!-- totales -->
      <rnd-tile-simple options="{title:'por pagar'}">{{resumen.saldoDeuda|monitor:'currency'}}</rnd-tile-simple>
      <rnd-tile-simple options="{title:'total asignado'}">{{resumen.asignadoCruce|monitor:'currency'}}</rnd-tile-simple>
      <!-- /totales -->
    </div>

    <div class="col-xs-12">
      <!-- Deuda -->
      <rnd-smtable meta="metaDeuda.data"
                   options="{showEmpty:'¡Todo pagado!', title:'Estado de cuenta',pagesize:3, pageheight:3}"
                   source="pasoDeuda"
                   dialog="{selectRow:selectRow}"
                   rtablas="metaDeuda.rtablas"
                   api="apiDeuda">
      </rnd-smtable>
      <!-- /Deuda -->
    </div>
  </div>

  <!-- #ROW: Pagos, Asignación, acciones -->
  <div rnd-row
       class="rnd-white shadow-b">

    <div class="col-md-8 col-lg-7 pt-20">
      <!-- /Pagos -->
      <rnd-smtable meta="metaPago.data"
                   options="{showEmpty:'No hay pagos registrados', title:'Registro de pagos', textCreate:'Ingresar un documento de pago', pagesize:5, xpageheight:5}"
                   source="pasoPago"
                   rtablas="metaPago.rtablas"
                   dialog="{selectRow:selectRow,onChange:onChangeValue, onAddRow:onAddRowPago, canCreate:true }"
                   api="apiPago">
      </rnd-smtable>
      <!-- /Pagos -->
    </div>

    <div class="col-sm-8 col-md-4 col-lg-5 pt-20">

      <div ng-repeat="pago in pasoPago.data"
           ng-if="pago.isSelected">

        <!-- titulo del pago -->
        <div class="mb-0">
          <strong>Asignación de: {{pago.TIDP}}</strong>
          <span> {{pago.NUDP}}</span>
          <span class="mr-20"
                style="position:absolute; right:0px">
            <small class="ml-5">saldo: </small>
            <span>{{pago.SALDODP|monitor:'currency'}}</span>
          </span>
        </div>
        <!-- /título del pago -->

        <!-- Cruce -->
        <rnd-smtable meta="metaCruce.data"
                     options="{showEmpty:'No hay asignaciones'}"
                     source="{data:pago.$cruce}"
                     dialog="{onChange:onChangeValue}"
                     api="apiCruce">
        </rnd-smtable>
        <!-- /Cruce -->

      </div>
    </div>

    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center p-20">
      <button ng-disabled="!resumen.canSave" type="button"
              class="btn btn-greensea btn-border btn-rounded-20">Guardar cambios</button>
    </div>

  </div>

</section>